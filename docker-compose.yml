services:
  zebra:
    build:
      context: ./docker/zebra
      dockerfile: Dockerfile
    container_name: zeckit-zebra
    ports:
      - "127.0.0.1:8232:8232"
    volumes:
      - ./docker/configs/zebra.toml:/etc/zebrad/zebrad.toml:ro
      - zebra-data:/var/zebra
    environment:
      - NETWORK=Regtest
    networks:
      - zeckit-network
    restart: unless-stopped

  lightwalletd:
    image: electriccoinco/lightwalletd:latest
    container_name: zeckit-lightwalletd
    ports:
      - "127.0.0.1:9067:9067"
    depends_on:
      - zebra
    command: [
      "--grpc-bind-addr=0.0.0.0:9067",
      "--rpchost=zebra",
      "--rpcport=8232",
      "--rpcuser=zcashrpc",
      "--rpcpassword=notsecure",
      "--log-file=/dev/stdout",
      "--log-level=7",
      "--no-tls-very-insecure=true"
    ]
    volumes:
      - lightwalletd-data:/var/lib/lightwalletd
    networks:
      - zeckit-network
    restart: unless-stopped
    profiles:
      - lwd

  zingo-wallet:
    build:
      context: ./docker/zingo
      dockerfile: Dockerfile
    container_name: zeckit-zingo-wallet
    volumes:
      - zingo-data:/var/zingo
    depends_on:
      - zebra
      - lightwalletd
    environment:
      - ZINGO_DATA_DIR=/var/zingo
      - LIGHTWALLETD_URI=http://lightwalletd:9067
    networks:
      - zeckit-network
    restart: unless-stopped
    profiles:
      - lwd

  faucet:
    build:
      context: ./faucet
      dockerfile: Dockerfile
    container_name: zeckit-faucet
    ports:
      - "8080:8080"
    volumes:
      - ./faucet:/app
      - zingo-data:/var/zingo:ro
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - LIGHTWALLETD_URI=http://lightwalletd:9067
    depends_on:
      - lightwalletd
      - zingo-wallet
    networks:
      - zeckit-network
    restart: unless-stopped
    profiles:
      - lwd
    user: "root"  # Run as root to access docker socket

networks:
  zeckit-network:
    driver: bridge

volumes:
  zebra-data:
  zingo-data:
  lightwalletd-data: